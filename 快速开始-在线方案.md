# 快速开始 - 在线方案（最少安装）

## 方案对比

| 方案 | 需要安装 | 数据库 | 部署 | 推荐度 |
|------|---------|--------|------|--------|
| **方案A：PlanetScale + 本地** | Node.js | 在线免费 | 本地运行 | ⭐⭐⭐⭐⭐ |
| **方案B：Docker** | Docker Desktop | 本地容器 | 本地运行 | ⭐⭐⭐⭐ |
| **方案C：完全在线** | Node.js（仅开发） | 在线 | 在线部署 | ⭐⭐⭐ |

---

## 🚀 方案A：PlanetScale + 本地开发（推荐）

### 优点
- ✅ 完全免费
- ✅ 无需安装数据库
- ✅ 自动备份
- ✅ 无需管理

### 步骤

#### 1. 注册数据库服务（2分钟）

**选项A：PlanetScale（国外，推荐）**
1. 访问 https://planetscale.com
2. 点击 "Sign up" 使用 GitHub 账号登录
3. 创建新数据库（Create database）
4. 数据库名称：`competition_db`
5. 选择免费计划（Free）

**选项B：国内数据库服务（推荐国内用户）**

**阿里云 RDS MySQL（推荐）**
- 网址：https://www.aliyun.com/product/rds/mysql
- 免费试用：新用户可免费试用1个月
- 按量付费：约 0.5-1元/天（最低配置）
- 优点：稳定、速度快、国内访问快

**腾讯云 MySQL**
- 网址：https://cloud.tencent.com/product/cdb
- 免费试用：新用户可免费试用1个月
- 按量付费：约 0.5-1元/天
- 优点：稳定、支持多种规格

**华为云 RDS MySQL**
- 网址：https://www.huaweicloud.com/product/rds.html
- 免费试用：新用户可免费试用1个月
- 优点：企业级稳定

**UCloud MySQL**
- 网址：https://www.ucloud.cn/site/product/udb.html
- 免费试用：新用户可免费试用
- 优点：价格实惠

**其他免费选项：**
- **Supabase（支持国内访问）**：https://supabase.com（PostgreSQL，需修改配置）
- **Railway（支持国内访问）**：https://railway.app（$5/月免费额度）

#### 2. 获取连接字符串（1分钟）

**PlanetScale：**
1. 在数据库页面点击 "Connect"
2. 选择 "General" 标签
3. 复制连接字符串，格式类似：
   ```
   mysql://用户名:密码@主机:端口/数据库名?sslaccept=strict
   ```

**国内云服务（阿里云/腾讯云/华为云等）：**
1. 登录云服务控制台
2. 进入 RDS/数据库 管理页面
3. 找到你的数据库实例
4. 查看"连接信息"或"数据库连接"
5. 获取：
   - 内网地址/外网地址（外网需要开启外网访问）
   - 端口（默认3306）
   - 数据库名
   - 用户名和密码
6. 连接字符串格式：
   ```
   mysql://用户名:密码@外网地址:3306/数据库名
   ```
   注意：如果使用外网访问，需要在安全组中开放3306端口

#### 3. 运行配置脚本
```powershell
.\setup-online.ps1
```
按提示输入连接字符串即可。

#### 4. 初始化数据库
```powershell
cd backend
npm run prisma:generate
npm run prisma:migrate
```

#### 5. 启动项目
```powershell
# 终端1 - 后端
cd backend
npm run dev

# 终端2 - 前端
cd frontend
npm run dev
```

#### 6. 访问系统
- 前端：http://localhost:3000
- 后端：http://localhost:3001

---

## 🐳 方案B：Docker 一键启动

### 优点
- ✅ 只需安装 Docker
- ✅ 一键启动所有服务
- ✅ 无需配置

### 步骤

#### 1. 安装 Docker Desktop
- 下载：https://www.docker.com/products/docker-desktop
- 安装并启动 Docker Desktop

#### 2. 启动所有服务
```powershell
docker-compose up -d
```

#### 3. 初始化数据库
```powershell
# 进入后端容器
docker exec -it competition-backend sh

# 运行迁移
npm run prisma:migrate

# 退出容器
exit
```

#### 4. 访问系统
- 前端：http://localhost:3000
- 后端：http://localhost:3001

#### 停止服务
```powershell
docker-compose down
```

---

## ☁️ 方案C：完全在线部署

### 优点
- ✅ 无需本地运行
- ✅ 可分享给他人使用
- ✅ 自动更新

### 步骤

#### 1. 数据库：使用 PlanetScale（同上）

#### 2. 后端部署到 Railway
1. 访问 https://railway.app
2. 使用 GitHub 登录
3. 点击 "New Project" -> "Deploy from GitHub repo"
4. 选择项目仓库
5. 添加环境变量：
   - `DATABASE_URL`: 你的 PlanetScale 连接字符串
   - `JWT_SECRET`: 随机字符串
   - `PORT`: 3001
   - `NODE_ENV`: production
6. Railway 会自动部署

#### 3. 前端部署到 Vercel
1. 访问 https://vercel.com
2. 使用 GitHub 登录
3. 点击 "Add New" -> "Project"
4. 导入项目仓库
5. 设置环境变量：
   - `VITE_API_URL`: 你的 Railway 后端地址
6. Vercel 会自动部署

---

## 📝 环境变量配置说明

### 后端 .env 文件
```env
# 数据库（从 PlanetScale 获取）
DATABASE_URL="mysql://用户名:密码@主机:端口/数据库名?sslaccept=strict"

# JWT密钥（随机生成，至少32位）
JWT_SECRET="your-random-secret-key-here"
JWT_EXPIRES_IN="7d"

# 服务器配置
PORT=3001
NODE_ENV=development

# CORS配置
CORS_ORIGIN="http://localhost:3000"
```

### 前端环境变量（部署时需要）
```env
VITE_API_URL=http://localhost:3001
```

---

## ❓ 常见问题

### Q: PlanetScale 免费额度够用吗？
A: 免费计划包含 5GB 存储和每月 10 亿行读取，对于中小型项目完全够用。

### Q: 数据库连接失败？
A: 检查：
1. 连接字符串是否正确
2. PlanetScale 数据库是否已创建
3. 是否启用了 SSL（PlanetScale 要求 SSL）

### Q: 如何重置数据库？
A: 在 PlanetScale 控制台可以删除并重新创建数据库，然后重新运行迁移。

### Q: 可以切换数据库服务吗？
A: 可以，只需修改 `.env` 文件中的 `DATABASE_URL` 即可。

---

## 🎯 推荐流程

1. **开发阶段**：使用方案A（PlanetScale + 本地）
2. **生产部署**：使用方案C（完全在线）

这样既方便开发，又便于部署。
