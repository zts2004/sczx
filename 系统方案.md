# 在线竞赛报名系统 - 设计方案

## 一、技术栈选择

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI框架**: Tailwind CSS + shadcn/ui 组件库
- **状态管理**: Zustand 或 React Context
- **路由**: React Router v6
- **HTTP客户端**: Axios
- **表单处理**: React Hook Form + Zod 验证
- **实时通信**: Socket.io-client

### 后端技术栈
- **运行时**: Node.js + Express
- **语言**: TypeScript
- **数据库**: MySQL 8.0+ (或 PostgreSQL)
- **ORM**: Prisma 或 TypeORM
- **认证**: JWT (JSON Web Token)
- **实时通信**: Socket.io
- **文件上传**: Multer
- **密码加密**: bcrypt

### 部署方案
- **前端**: Vercel / Netlify / 静态服务器
- **后端**: Node.js 服务器 (PM2 进程管理)
- **数据库**: 云数据库服务

---

## 二、系统架构

```
┌─────────────────┐
│   前端 (React)   │
│  - 用户界面      │
│  - 状态管理      │
└────────┬────────┘
         │ HTTP/WebSocket
┌────────▼────────┐
│   后端 (Express) │
│  - API 路由      │
│  - 业务逻辑      │
│  - 认证授权      │
└────────┬────────┘
         │
┌────────▼────────┐
│   数据库 (MySQL) │
│  - 用户数据      │
│  - 竞赛数据      │
│  - 报名数据      │
└─────────────────┘
```

---

## 三、用户角色设计

### 1. 普通用户 (User)
- 注册账号
- 登录/登出
- 浏览竞赛列表
- 查看竞赛详情
- 报名参加竞赛
- 查看自己的报名记录
- 取消报名（在允许时间内）
- 修改个人资料
- 查看报名状态
- 上传获奖图片（校级/省级/国家级）
- 查看自己的获奖记录
- 查看院级获奖证书

### 2. 管理员 (Admin)
- 所有普通用户功能
- 创建竞赛
- 编辑竞赛信息
- 删除竞赛
- 审核报名申请
- 管理用户账号
- 查看统计数据
- 导出报名数据
- 发送系统通知
- 发放院级获奖证书
- 审核用户上传的获奖图片
- 管理获奖记录

### 3. 超级管理员 (Super Admin)
- 所有管理员功能
- 管理系统设置
- 管理其他管理员账号
- 查看系统日志

---

## 四、核心功能模块

### 4.1 用户认证模块
- ✅ 用户注册
  - 邮箱/手机号注册
  - 密码强度验证
  - 邮箱验证（可选）
  - 验证码验证
  
- ✅ 用户登录
  - 账号密码登录
  - 记住登录状态
  - 登录失败次数限制
  
- ✅ 密码管理
  - 忘记密码（邮箱重置）
  - 修改密码
  - 密码加密存储

- ✅ 会话管理
  - JWT Token 认证
  - Token 刷新机制
  - 登出功能

### 4.2 竞赛管理模块
- ✅ 竞赛列表
  - 分页显示
  - 搜索功能（按名称、类型）
  - 筛选功能（状态、类型、时间）
  - 排序功能（时间、热度）
  
- ✅ 竞赛详情
  - 竞赛基本信息
  - 报名要求说明
  - 时间安排
  - 奖项设置
  - 已报名人数显示
  - 报名状态提示

- ✅ 竞赛创建/编辑（管理员）
  - 竞赛名称
  - 竞赛描述
  - 竞赛类型（学术、体育、艺术等）
  - 报名开始/结束时间
  - 竞赛开始/结束时间
  - 报名人数限制
  - 报名要求（年龄、学历等）
  - 竞赛规则
  - 奖项设置
  - 封面图片上传
  - 附件上传

- ✅ 竞赛状态管理
  - 未开始
  - 报名中
  - 报名已结束
  - 进行中
  - 已结束
  - 已取消

### 4.3 报名管理模块
- ✅ 报名功能
  - 选择竞赛报名
  - 填写报名信息表单
  - 上传相关材料（可选）
  - 提交报名申请
  - 报名成功确认
  
- ✅ 报名信息管理
  - 查看自己的报名记录
  - 查看报名详情
  - 修改报名信息（在允许时间内）
  - 取消报名（在允许时间内）
  - 查看报名状态（待审核/已通过/已拒绝/已取消）

- ✅ 报名审核（管理员）
  - 查看所有报名申请
  - 审核报名（通过/拒绝）
  - 批量审核
  - 添加审核备注
  - 导出报名名单

- ✅ 报名限制
  - 每人每竞赛只能报名一次
  - 报名时间限制
  - 人数上限限制
  - 报名条件验证（年龄、学历等）

### 4.4 个人中心模块
- ✅ 个人信息管理
  - 查看个人资料
  - 编辑个人信息（姓名、头像、联系方式等）
  - 修改密码
  - 账号安全设置

- ✅ 我的报名
  - 报名记录列表
  - 报名详情查看
  - 报名状态跟踪
  - 下载报名凭证

- ✅ 消息通知
  - 系统通知
  - 报名审核结果通知
  - 竞赛状态变更通知
  - 未读消息提醒

- ✅ 获奖管理
  - 上传获奖图片
    - 选择获奖级别（校级/省级/国家级）
    - 关联竞赛（可选）
    - 上传获奖证书图片
    - 填写获奖信息（获奖名称、获奖时间、获奖等级等）
    - 图片格式验证（jpg/png，大小限制）
  - 查看获奖记录
    - 按级别筛选（校级/省级/国家级）
    - 按时间排序
    - 查看获奖详情
    - 查看获奖图片
  - 编辑/删除获奖记录（在允许时间内）
  - 查看院级获奖证书
    - 查看管理员发放的院级证书
    - 下载证书

### 4.5 后台管理模块（管理员）
- ✅ 竞赛管理
  - 竞赛列表管理
  - 创建/编辑/删除竞赛
  - 批量操作
  - 竞赛数据统计

- ✅ 报名管理
  - 所有报名记录查看
  - 报名审核
  - 报名数据导出（Excel）
  - 报名统计分析

- ✅ 用户管理
  - 用户列表查看
  - 用户信息编辑
  - 用户状态管理（启用/禁用）
  - 用户权限管理

- ✅ 数据统计
  - 竞赛数量统计
  - 报名人数统计
  - 用户活跃度统计
  - 数据可视化图表

- ✅ 系统设置
  - 系统参数配置
  - 通知模板管理
  - 系统日志查看

- ✅ 获奖证书管理
  - 发放院级获奖证书
    - 选择获奖用户
    - 关联竞赛（可选）
    - 填写证书信息（证书名称、获奖等级、发放时间等）
    - 上传证书模板或生成证书
    - 证书编号自动生成
    - 批量发放证书
  - 审核用户上传的获奖图片
    - 查看待审核的获奖图片
    - 审核通过/拒绝
    - 添加审核备注
    - 批量审核
  - 获奖记录管理
    - 查看所有获奖记录
    - 按级别筛选（校级/省级/国家级/院级）
    - 编辑/删除获奖记录
    - 导出获奖数据统计
  - 获奖统计分析
    - 各级别获奖数量统计
    - 获奖用户统计
    - 获奖趋势分析

### 4.6 实时功能模块
- ✅ 实时通知
  - 报名审核结果实时推送
  - 竞赛状态变更通知
  - 系统公告推送

- ✅ 实时数据更新
  - 报名人数实时更新
  - 竞赛状态实时同步

---

## 五、数据库设计

### 5.1 用户表 (users)
```sql
- id: 主键
- username: 用户名（唯一）
- email: 邮箱（唯一）
- password: 密码（加密）
- phone: 手机号（可选）
- real_name: 真实姓名
- avatar: 头像URL
- role: 角色（user/admin/super_admin）
- status: 状态（active/inactive）
- created_at: 创建时间
- updated_at: 更新时间
```

### 5.2 竞赛表 (competitions)
```sql
- id: 主键
- title: 竞赛名称
- description: 竞赛描述
- type: 竞赛类型
- cover_image: 封面图片URL
- start_time: 竞赛开始时间
- end_time: 竞赛结束时间
- registration_start: 报名开始时间
- registration_end: 报名结束时间
- max_participants: 最大报名人数
- current_participants: 当前报名人数
- requirements: 报名要求（JSON）
- rules: 竞赛规则
- awards: 奖项设置（JSON）
- status: 状态
- created_by: 创建者ID
- created_at: 创建时间
- updated_at: 更新时间
```

### 5.3 报名表 (registrations)
```sql
- id: 主键
- user_id: 用户ID
- competition_id: 竞赛ID
- registration_data: 报名信息（JSON）
- attachments: 附件URLs（JSON）
- status: 状态（pending/approved/rejected/cancelled）
- reviewed_by: 审核人ID
- reviewed_at: 审核时间
- review_notes: 审核备注
- created_at: 创建时间
- updated_at: 更新时间
```

### 5.4 通知表 (notifications)
```sql
- id: 主键
- user_id: 用户ID
- type: 通知类型
- title: 通知标题
- content: 通知内容
- is_read: 是否已读
- created_at: 创建时间
```

### 5.5 系统日志表 (logs)
```sql
- id: 主键
- user_id: 用户ID
- action: 操作类型
- resource: 资源类型
- resource_id: 资源ID
- details: 详细信息（JSON）
- ip_address: IP地址
- created_at: 创建时间
```

### 5.6 获奖记录表 (awards)
```sql
- id: 主键
- user_id: 用户ID
- competition_id: 竞赛ID（可选，可为空）
- award_level: 获奖级别（school/provincial/national/college）
  - school: 校级
  - provincial: 省级
  - national: 国家级
  - college: 院级（由管理员发放）
- award_name: 获奖名称
- award_rank: 获奖等级（一等奖/二等奖/三等奖/优秀奖等）
- award_time: 获奖时间
- certificate_image: 证书图片URL（用户上传或管理员生成）
- certificate_number: 证书编号（院级证书自动生成）
- description: 获奖描述
- status: 状态（pending/approved/rejected）
  - pending: 待审核（仅用户上传的校级/省级/国家级需要审核）
  - approved: 已通过
  - rejected: 已拒绝
- reviewed_by: 审核人ID（管理员）
- reviewed_at: 审核时间
- review_notes: 审核备注
- issued_by: 发放人ID（院级证书的发放管理员）
- created_at: 创建时间
- updated_at: 更新时间
```

---

## 六、API 接口设计

### 6.1 认证相关
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `POST /api/auth/refresh` - 刷新Token
- `POST /api/auth/forgot-password` - 忘记密码
- `POST /api/auth/reset-password` - 重置密码

### 6.2 用户相关
- `GET /api/users/profile` - 获取个人信息
- `PUT /api/users/profile` - 更新个人信息
- `PUT /api/users/password` - 修改密码

### 6.3 竞赛相关
- `GET /api/competitions` - 获取竞赛列表（支持分页、搜索、筛选）
- `GET /api/competitions/:id` - 获取竞赛详情
- `POST /api/competitions` - 创建竞赛（管理员）
- `PUT /api/competitions/:id` - 更新竞赛（管理员）
- `DELETE /api/competitions/:id` - 删除竞赛（管理员）

### 6.4 报名相关
- `POST /api/registrations` - 提交报名
- `GET /api/registrations/my` - 获取我的报名记录
- `GET /api/registrations/:id` - 获取报名详情
- `PUT /api/registrations/:id` - 更新报名信息
- `DELETE /api/registrations/:id` - 取消报名
- `GET /api/registrations/competition/:id` - 获取竞赛的所有报名（管理员）
- `PUT /api/registrations/:id/review` - 审核报名（管理员）
- `GET /api/registrations/export/:id` - 导出报名数据（管理员）

### 6.5 通知相关
- `GET /api/notifications` - 获取通知列表
- `PUT /api/notifications/:id/read` - 标记为已读
- `PUT /api/notifications/read-all` - 全部标记为已读

### 6.6 获奖相关
- `POST /api/awards` - 上传获奖图片（用户）
- `GET /api/awards/my` - 获取我的获奖记录
- `GET /api/awards/:id` - 获取获奖详情
- `PUT /api/awards/:id` - 更新获奖信息（用户）
- `DELETE /api/awards/:id` - 删除获奖记录（用户）
- `GET /api/awards` - 获取获奖列表（支持筛选、分页）

### 6.7 管理相关（管理员）
- `GET /api/admin/users` - 获取用户列表
- `PUT /api/admin/users/:id` - 更新用户信息
- `GET /api/admin/statistics` - 获取统计数据
- `POST /api/admin/awards/certificate` - 发放院级获奖证书
- `GET /api/admin/awards` - 获取所有获奖记录（管理员）
- `PUT /api/admin/awards/:id/review` - 审核获奖图片（管理员）
- `GET /api/admin/awards/statistics` - 获取获奖统计数据
- `GET /api/admin/awards/export` - 导出获奖数据（Excel）

---

## 七、安全设计

1. **密码安全**
   - 使用 bcrypt 加密存储
   - 密码强度要求
   - 登录失败次数限制

2. **API 安全**
   - JWT Token 认证
   - 请求频率限制（Rate Limiting）
   - CORS 配置
   - 输入验证和清理

3. **数据安全**
   - SQL 注入防护（使用 ORM）
   - XSS 攻击防护
   - CSRF 防护
   - 敏感数据加密

4. **权限控制**
   - 基于角色的访问控制（RBAC）
   - 接口权限验证
   - 前端路由守卫

---

## 八、UI/UX 设计要点

1. **响应式设计**
   - 支持 PC、平板、手机多端访问
   - 移动端优先设计

2. **用户体验**
   - 清晰的导航结构
   - 友好的错误提示
   - 加载状态提示
   - 操作确认对话框

3. **视觉设计**
   - 现代化的界面风格
   - 统一的色彩方案
   - 清晰的层次结构
   - 合适的字体和间距

---

## 九、开发计划

### 第一阶段：基础框架搭建
- 项目初始化
- 数据库设计
- 基础 API 开发
- 前端框架搭建

### 第二阶段：核心功能开发
- 用户认证系统
- 竞赛管理功能
- 报名功能

### 第三阶段：管理功能开发
- 后台管理界面
- 数据统计功能
- 审核功能

### 第四阶段：优化和完善
- 实时通知功能
- 性能优化
- 安全加固
- 测试和调试

---

## 十、获奖功能详细说明

### 10.1 用户端获奖图片上传功能

#### 功能描述
用户可以在个人中心上传自己在各类竞赛中获得的获奖证书图片，系统支持三个级别的获奖：
- **校级**：学校级别的竞赛获奖
- **省级**：省级别的竞赛获奖
- **国家级**：国家级别的竞赛获奖

#### 上传流程
1. 用户进入"我的获奖"页面
2. 点击"上传获奖"按钮
3. 选择获奖级别（校级/省级/国家级）
4. 填写获奖信息：
   - 获奖名称（必填）
   - 获奖时间（必填）
   - 获奖等级（一等奖/二等奖/三等奖/优秀奖等）
   - 关联竞赛（可选，可从已报名的竞赛中选择）
   - 获奖描述（可选）
5. 上传获奖证书图片（支持jpg、png格式，单张不超过5MB）
6. 提交后等待管理员审核（校级/省级/国家级需要审核）

#### 功能特点
- 支持多张图片上传（最多3张）
- 图片预览功能
- 图片格式和大小验证
- 上传进度显示
- 审核状态实时更新
- 支持编辑和删除（在审核通过前）

### 10.2 管理员端院级获奖证书发放功能

#### 功能描述
管理员可以为用户发放院级获奖证书，这是系统内部管理的证书级别，由管理员直接发放，无需用户上传。

#### 发放流程
1. 管理员进入"获奖证书管理"页面
2. 点击"发放院级证书"按钮
3. 选择获奖用户（支持搜索）
4. 填写证书信息：
   - 证书名称（必填）
   - 关联竞赛（可选）
   - 获奖等级（必填）
   - 获奖时间（必填）
   - 证书描述（可选）
5. 上传证书图片或使用系统证书模板生成
6. 系统自动生成唯一证书编号
7. 确认发放，系统自动通知用户

#### 功能特点
- 支持单个或批量发放证书
- 证书编号自动生成（格式：COLLEGE-YYYYMMDD-XXXX）
- 支持证书模板管理
- 支持证书图片上传或在线生成
- 发放后自动通知用户
- 支持证书编辑和撤销
- 证书数据统计和导出

#### 证书审核功能
管理员可以审核用户上传的校级/省级/国家级获奖图片：
- 查看待审核的获奖记录
- 查看获奖图片详情
- 审核通过或拒绝
- 添加审核备注
- 批量审核功能

### 10.3 获奖记录管理

#### 用户端
- 查看所有获奖记录（按级别分类）
- 筛选和搜索功能
- 查看获奖详情和图片
- 下载获奖证书（院级证书可下载）

#### 管理员端
- 查看所有用户的获奖记录
- 按级别、时间、用户筛选
- 获奖数据统计和分析
- 导出获奖数据（Excel格式）
- 获奖趋势图表展示

### 10.4 数据统计功能

管理员可以查看以下统计数据：
- 各级别获奖数量统计（校级/省级/国家级/院级）
- 获奖用户排行榜
- 获奖时间分布统计
- 获奖等级分布统计
- 各竞赛获奖情况统计

---

## 十一、技术难点和解决方案

1. **并发报名控制**
   - 使用数据库事务
   - 乐观锁机制
   - 队列处理

2. **实时通知**
   - WebSocket 连接管理
   - 消息队列
   - 离线消息存储

3. **文件上传**
   - 文件大小限制
   - 文件类型验证
   - 云存储集成
   - 图片压缩和优化
   - 获奖证书图片水印（可选）

4. **性能优化**
   - 数据库索引优化
   - 缓存机制（Redis）
   - 分页加载
   - 图片懒加载

---

请确认以上方案是否符合您的需求。如有需要调整或补充的地方，请告诉我，我会根据您的反馈进行修改。

