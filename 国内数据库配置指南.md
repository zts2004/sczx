# 国内数据库配置指南

## 推荐国内 MySQL 数据库服务

### 1. 阿里云 RDS MySQL（最推荐）

#### 优点
- ✅ 国内访问速度快
- ✅ 稳定可靠
- ✅ 新用户免费试用1个月
- ✅ 按量付费，成本低（约0.5-1元/天）

#### 注册步骤
1. 访问：https://www.aliyun.com
2. 注册/登录账号
3. 进入控制台 -> 产品与服务 -> 云数据库 RDS MySQL
4. 创建实例：
   - 选择"按量付费"（更灵活）
   - 选择地域（建议选择离你最近的地域）
   - 选择规格：`mysql.n2.medium.1`（1核1GB，约0.5元/小时）
   - 存储：20GB（约0.1元/GB/月）
   - 网络类型：专有网络VPC
   - 设置root密码

#### 配置外网访问
1. 在RDS实例详情页
2. 点击"数据安全性" -> "白名单设置"
3. 添加白名单：`0.0.0.0/0`（允许所有IP，开发用）
4. 点击"连接信息" -> "申请外网地址"
5. 获取外网地址和端口

#### 连接字符串格式
```
mysql://root:你的密码@外网地址:3306/数据库名
```

#### 创建数据库
1. 使用数据库管理工具（如 Navicat、DBeaver）连接
2. 或使用阿里云的数据管理DMS
3. 创建数据库：`competition_db`
4. 字符集：`utf8mb4`
5. 排序规则：`utf8mb4_unicode_ci`

---

### 2. 腾讯云 MySQL

#### 优点
- ✅ 国内访问速度快
- ✅ 新用户免费试用
- ✅ 价格实惠

#### 注册步骤
1. 访问：https://cloud.tencent.com
2. 注册/登录账号
3. 进入控制台 -> 云数据库 -> MySQL
4. 创建实例：
   - 计费模式：按量计费
   - 地域：选择最近的地域
   - 规格：1核1GB内存
   - 存储：20GB
   - 网络：私有网络VPC
   - 设置root密码

#### 配置外网访问
1. 实例详情 -> 连接信息
2. 开启"外网地址"
3. 在"安全组"中开放3306端口
4. 获取外网地址

#### 连接字符串
```
mysql://root:你的密码@外网地址:3306/数据库名
```

---

### 3. 华为云 RDS MySQL

#### 优点
- ✅ 企业级稳定
- ✅ 国内访问快

#### 注册步骤
1. 访问：https://www.huaweicloud.com
2. 注册/登录
3. 控制台 -> 云数据库 RDS -> MySQL
4. 购买实例（新用户有免费试用）

---

### 4. UCloud MySQL

#### 优点
- ✅ 价格实惠
- ✅ 新用户有优惠

#### 注册步骤
1. 访问：https://www.ucloud.cn
2. 注册/登录
3. 控制台 -> 云数据库 UDB -> MySQL

---

## 快速配置脚本使用

运行配置脚本时，选择"选项3：其他 MySQL 服务"，然后输入你的连接字符串：

```
mysql://用户名:密码@外网地址:3306/数据库名
```

例如（阿里云）：
```
mysql://root:MyPassword123@rm-xxxxx.mysql.rds.aliyuncs.com:3306/competition_db
```

---

## 成本估算

### 阿里云 RDS（按量付费）
- **最低配置**：1核1GB，20GB存储
- **成本**：约 0.5元/小时 × 24小时 = 12元/天
- **月成本**：约 360元/月
- **建议**：开发阶段可以按需开启，用完即停，降低成本

### 包年包月（更便宜）
- 1核1GB，20GB存储
- 约 200-300元/月
- 适合长期使用

### 免费试用
- 新用户通常有1个月免费试用
- 足够完成开发和测试

---

## 安全建议

1. **生产环境**：
   - 不要使用 `0.0.0.0/0` 白名单
   - 只允许特定IP访问
   - 使用强密码
   - 定期备份

2. **开发环境**：
   - 可以使用外网访问方便开发
   - 使用简单密码（但不要用默认密码）
   - 定期清理测试数据

---

## 常见问题

### Q: 外网访问很慢？
A: 建议使用内网访问（如果后端也在同一云平台），或选择离你最近的地域。

### Q: 如何降低成本？
A: 
- 开发阶段使用按量付费，不用时关闭实例
- 使用最低配置（1核1GB）
- 选择包年包月（比按量付费便宜约30%）

### Q: 数据库连接失败？
A: 检查：
1. 安全组是否开放3306端口
2. 白名单是否包含你的IP
3. 外网地址是否正确
4. 用户名密码是否正确

## 获奖证书图片上传（已支持真实文件上传）

系统现已支持在“我的获奖”中直接选择图片文件上传，后端会把图片保存到服务器并通过静态地址访问。

- **上传接口**：`POST /api/awards`（`multipart/form-data`）
- **文件字段名**：`certificate`
- **允许格式**：jpg / png / webp
- **默认大小限制**：5MB（可通过后端 `.env` 的 `MAX_FILE_SIZE` 调整）
- **图片访问路径**：`/uploads/awards/<filename>`（后端已配置静态目录：`/uploads`）

### Q: 如何备份数据？
A: 云服务商都提供自动备份功能，在控制台可以设置备份策略。

---

## 推荐配置流程

1. **注册阿里云账号**（新用户有优惠）
2. **创建RDS MySQL实例**（选择按量付费，最低配置）
3. **配置外网访问**（开放3306端口）
4. **创建数据库**（competition_db）
5. **运行配置脚本**：`.\setup-online.ps1`
6. **输入连接字符串**
7. **初始化数据库**：`npm run prisma:migrate`

完成！现在可以使用国内数据库了。
