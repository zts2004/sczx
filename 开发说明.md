# 开发说明文档

## 项目结构

```
竞赛收集/
├── backend/              # 后端服务
│   ├── src/
│   │   ├── modules/      # 功能模块
│   │   │   ├── auth/     # 认证模块
│   │   │   ├── user/     # 用户模块
│   │   │   ├── competition/  # 竞赛模块
│   │   │   ├── registration/ # 报名模块
│   │   │   ├── award/    # 获奖模块
│   │   │   ├── notification/ # 通知模块
│   │   │   └── admin/    # 管理模块
│   │   ├── middleware/   # 中间件
│   │   ├── utils/        # 工具函数
│   │   └── app.ts        # 应用入口
│   ├── prisma/           # 数据库配置
│   └── package.json
├── frontend/             # 前端应用
│   ├── src/
│   │   ├── components/  # 组件
│   │   ├── pages/        # 页面
│   │   ├── store/        # 状态管理
│   │   └── utils/        # 工具函数
│   └── package.json
└── 系统方案.md           # 系统设计方案
```

## 快速开始

### 后端启动

1. 进入后端目录
```bash
cd backend
```

2. 安装依赖
```bash
npm install
```

3. 配置环境变量
```bash
# 复制环境变量示例文件
cp env.example .env

# 编辑 .env 文件，配置数据库连接等信息
```

4. 初始化数据库
```bash
# 生成Prisma客户端
npm run prisma:generate

# 运行数据库迁移
npm run prisma:migrate
```

5. 启动开发服务器
```bash
npm run dev
```

后端服务将在 http://localhost:3001 启动

## 管理员 / 超级管理员账号

系统通过 `users.role` 字段区分权限：
- `user`: 普通用户
- `admin`: 管理员
- `super_admin`: 超级管理员

### 方式A：用脚本创建/提升管理员（推荐）

1. 在 `backend/.env` 里加入以下环境变量（示例）：

```env
ADMIN_ROLE="admin"
ADMIN_USERNAME="admin"
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="Admin123456"
ADMIN_STUDENT_ID="A00000001"
ADMIN_REALNAME="管理员"
```

2. 执行脚本（在 `backend` 目录）：

```bash
npm run create:admin
```

如果账号已存在，脚本会自动把该账号的 `role` 更新为 `ADMIN_ROLE`。

### 方式B：手动提升已有账号（数据库里改 role）

把某个用户的 `role` 改为 `admin` 或 `super_admin` 即可。

### 前端启动

1. 进入前端目录
```bash
cd frontend
```

2. 安装依赖
```bash
npm install
```

3. 启动开发服务器
```bash
npm run dev
```

前端应用将在 http://localhost:3000 启动

## 功能模块说明

### 已实现功能

#### 后端模块
- ✅ 用户认证（注册、登录、JWT）
- ✅ 用户管理（个人信息、密码修改）
- ✅ 竞赛管理（CRUD操作）
- ✅ 报名管理（报名、查看、取消）
- ✅ 获奖管理（上传、查看、审核、证书发放）
- ✅ 通知管理
- ✅ 管理员功能（审核、统计）

#### 前端页面
- ✅ 首页
- ✅ 登录/注册页面
- ✅ 竞赛列表和详情页
- ✅ 个人中心
- ✅ 我的报名
- ✅ 我的获奖（含上传功能）
- ✅ 管理员后台（统计概览）

### 待完善功能

- 前端管理员后台的详细功能（竞赛管理、报名审核、获奖审核、证书发放）
- 文件上传功能（目前使用URL方式）
- 实时通知（WebSocket）
- 数据导出功能

## 数据库配置
使用 PostgreSQL 数据库，通过 Prisma ORM 管理（也可接其他兼容数据库服务）。

数据库连接字符串格式：
```
DATABASE_URL="mysql://用户名:密码@主机:端口/数据库名"
```

## API接口

所有API接口前缀为 `/api`

主要接口：
- `/api/auth/*` - 认证相关
- `/api/users/*` - 用户相关
- `/api/competitions/*` - 竞赛相关
- `/api/registrations/*` - 报名相关
- `/api/awards/*` - 获奖相关
- `/api/notifications/*` - 通知相关
- `/api/admin/*` - 管理相关（需要管理员权限）

## 注意事项

1. 确保MySQL数据库已安装并运行
2. 首次运行需要执行数据库迁移
3. 环境变量需要正确配置
4. 前端需要配置代理指向后端（已在vite.config.ts中配置）

## 下一步开发建议

1. 完善管理员后台的详细功能
2. 实现文件上传功能（使用Multer）
3. 添加表单验证和错误处理
4. 实现实时通知功能
5. 添加数据导出功能（Excel）
6. 优化UI/UX
7. 添加单元测试和集成测试
